<!-- File: templates/eventos/form.html -->
<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <!-- head global (j√° inclui mototrack.css) -->
    <th:block th:replace="~{fragments/head :: head(${id != null} ? 'MotoTrack ‚Ä¢ Editar Evento' : 'MotoTrack ‚Ä¢ Novo Evento')}"></th:block>
    <!-- opcional: incluir css expl√≠cito -->
    <th:block th:replace="~{fragments/css :: mototrack}"></th:block>
</head>

<body>
<div class="wrap">
    <!-- Navbar -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="mt-20" aria-label="Formul√°rio de Evento">
        <!-- Sucesso -->
        <div class="flash ok" th:if="${msgSucesso}" th:text="${msgSucesso}"></div>

        <!-- Form principal -->
        <section class="card" aria-labelledby="form-title">
            <h2 id="form-title" th:text="${id != null ? '‚úèÔ∏è Editar Evento' : 'üóìÔ∏è Novo Evento'}">üóìÔ∏è Novo Evento</h2>
            <p class="muted" th:if="${id == null}">Preencha os dados abaixo para registrar um evento.</p>
            <p class="muted" th:if="${id != null}">Atualize apenas os campos necess√°rios.</p>

            <form th:action="${id != null} ? @{|/eventos/ui/${id}|} : @{/eventos/ui}"
                  method="post" th:object="${evento}">
                <!-- Erros globais -->
                <div class="flash err" th:if="${#fields.hasErrors('*')}">
                    <strong>Erros de valida√ß√£o:</strong>
                    <ul style="margin:8px 0 0 18px">
                        <li th:each="e : ${#fields.errors('*')}" th:text="${e}"></li>
                    </ul>
                </div>

                <!-- Grid dos campos (mesmo layout do .filter) -->
                <div class="filter">
                    <!-- Moto ID -->
                    <div>
                        <label for="motoId">Moto (ID)</label>
                        <input id="motoId" type="number" th:field="*{motoId}" min="1" placeholder="ID da moto" required/>
                        <div class="err" th:errors="*{motoId}" aria-live="polite"></div>
                    </div>

                    <!-- Tipo -->
                    <div>
                        <label for="tipo">Tipo</label>
                        <input id="tipo" type="text" th:field="*{tipo}" placeholder="Sa√≠da, Manuten√ß√£o, Entrada..." required/>
                        <div class="err" th:errors="*{tipo}" aria-live="polite"></div>
                    </div>

                    <!-- Motivo -->
                    <div>
                        <label for="motivo">Motivo</label>
                        <input id="motivo" type="text" th:field="*{motivo}" placeholder="Motivo do evento" required/>
                        <div class="err" th:errors="*{motivo}" aria-live="polite"></div>
                    </div>

                    <!-- Data/Hora -->
                    <div>
                        <label for="dataHora">Data/Hora</label>
                        <input id="dataHora" type="datetime-local" th:field="*{dataHora}"/>
                        <small class="muted">Formato: dd/mm/aaaa hh:mm</small>
                        <div class="err" th:errors="*{dataHora}" aria-live="polite"></div>
                    </div>

                    <!-- Localiza√ß√£o (linha inteira) -->
                    <div class="grid-span-all">
                        <label for="localizacao">Localiza√ß√£o</label>
                        <input id="localizacao" type="text" th:field="*{localizacao}" placeholder="Ex.: Oficina Centro"/>
                        <div class="err" th:errors="*{localizacao}" aria-live="polite"></div>
                    </div>
                </div>

                <!-- CSRF -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- A√ß√µes -->
                <div class="actions">
                    <button type="submit" class="btn primary"
                            th:text="${id != null ? 'Atualizar evento' : 'Salvar evento'}">Salvar</button>
                    <a class="btn ghost" th:href="@{/eventos/ui}">Voltar</a>
                </div>
            </form>
        </section>

        <!-- Excluir (somente ADMIN e quando h√° id) -->
        <section class="card mt-14" th:if="${id != null}" sec:authorize="hasRole('ADMIN')" aria-label="A√ß√µes avan√ßadas">
            <h2>A√ß√µes</h2>
            <form th:action="@{|/eventos/ui/${id}/excluir|}" method="post" style="display:inline">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button class="btn danger" type="submit" onclick="return confirm('Confirmar exclus√£o?')">Excluir</button>
            </form>
        </section>
    </main>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
