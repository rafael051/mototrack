<!-- File: templates/eventos/lista.html -->
<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <th:block th:replace="~{fragments/head :: head('MotoTrack ‚Ä¢ Eventos')}"></th:block>
    <th:block th:replace="~{fragments/css :: mototrack}"></th:block>
    <title>MotoTrack</title>
</head>

<body>
<div class="wrap">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="mt-20" aria-label="Lista de Eventos">
        <div class="page-wrap">
            <div th:replace="~{fragments/flash :: banners}"></div>

            <section class="card">
                <h2>üóìÔ∏è Eventos</h2>

                <!-- Filtro (usa apenas request params; sem operadores) -->
                <form class="filter" th:action="@{/eventos/ui}" method="get" aria-label="Filtro de eventos">
                    <div>
                        <label for="f-id">ID</label>
                        <input id="f-id" type="number" name="id" min="1"
                               th:value="${param.id}" placeholder="ex.: 10"/>
                    </div>

                    <div>
                        <label for="f-motoId">Moto (ID)</label>
                        <input id="f-motoId" type="number" name="motoId" min="1"
                               th:value="${param.motoId}" placeholder="ex.: 3"/>
                    </div>

                    <div>
                        <label for="f-tipo">Tipo</label>
                        <input id="f-tipo" type="text" name="tipo"
                               th:value="${param.tipo}" placeholder="Sa√≠da, Manuten√ß√£o..."/>
                    </div>

                    <div>
                        <label for="f-motivo">Motivo</label>
                        <input id="f-motivo" type="text" name="motivo"
                               th:value="${param.motivo}" placeholder="Motivo"/>
                    </div>

                    <div>
                        <label for="f-localizacao">Localiza√ß√£o</label>
                        <input id="f-localizacao" type="text" name="localizacao"
                               th:value="${param.localizacao}" placeholder="P√°tio, oficina..."/>
                    </div>

                    <!-- Per√≠odo (EventoFilter usa LocalDate -> input type="date") -->
                    <div>
                        <label for="f-dataInicio">Data inicial</label>
                        <input id="f-dataInicio" type="date" name="dataInicio"
                               th:value="${param.dataInicio}"/>
                    </div>
                    <div>
                        <label for="f-dataFim">Data final</label>
                        <input id="f-dataFim" type="date" name="dataFim"
                               th:value="${param.dataFim}"/>
                    </div>

                    <div class="row">
                        <button class="btn ghost" type="submit">Filtrar</button>
                        <a class="btn ghost" th:href="@{/eventos/ui}">Limpar</a>
                    </div>
                </form>

                <!-- A√ß√µes ADMIN -->
                <div class="row my-12" sec:authorize="hasRole('ADMIN')">
                    <a class="btn primary" th:href="@{/eventos/ui/novo}">‚ûï Novo evento</a>
                </div>

                <!-- Tabela -->
                <div class="table-wrap" role="region" aria-label="Tabela de eventos">
                    <table>
                        <thead>
                        <tr>
                            <th class="col-id">ID</th>
                            <th>Data/Hora</th>
                            <th>Moto</th>
                            <th>Tipo</th>
                            <th>Motivo</th>
                            <th>Localiza√ß√£o</th>
                            <th class="col-actions">A√ß√µes</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="row : ${page.content}">
                            <td th:text="${row.id}"></td>
                            <td th:text="${#temporals.format(row.dataHora, 'dd/MM/yyyy HH:mm')}"></td>
                            <td th:text="${row.motoPlaca != null ? row.motoPlaca : row.motoId}"></td>
                            <td th:text="${row.tipo}"></td>
                            <td th:text="${row.motivo}"></td>
                            <td th:text="${row.localizacao}"></td>
                            <td class="actions-cell">
                                <a class="btn warn" th:href="@{|/eventos/ui/${row.id}/editar|}"
                                   sec:authorize="hasRole('ADMIN')">Editar</a>
                                <form class="inline" th:action="@{|/eventos/ui/${row.id}/excluir|}" method="post"
                                      sec:authorize="hasRole('ADMIN')">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button class="btn danger" type="submit"
                                            onclick="return confirm('Confirmar exclus√£o?')">Excluir</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${page.content.size() == 0}">
                            <td colspan="7" class="text-center">
                                <span class="text-muted">Nenhum registro encontrado.</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagina√ß√£o (somente params; sem Elvis/tern√°rios) -->
                <div class="pager" aria-label="Pagina√ß√£o">
                    <span>
                        P√°gina <strong th:text="${page.number + 1}"></strong>
                        de <strong th:text="${page.totalPages}"></strong>
                    </span>

                    <span th:if="${page.hasPrevious()}">
                        <a th:href="@{|/eventos/ui?page=${page.number - 1}&size=${page.size}
                                      &id=${param.id}&motoId=${param.motoId}
                                      &tipo=${param.tipo}&motivo=${param.motivo}
                                      &localizacao=${param.localizacao}
                                      &dataInicio=${param.dataInicio}&dataFim=${param.dataFim}|}">
                            Anterior
                        </a>
                    </span>

                    <span th:if="${page.hasNext()}">
                        <a th:href="@{|/eventos/ui?page=${page.number + 1}&size=${page.size}
                                      &id=${param.id}&motoId=${param.motoId}
                                      &tipo=${param.tipo}&motivo=${param.motivo}
                                      &localizacao=${param.localizacao}
                                      &dataInicio=${param.dataInicio}&dataFim=${param.dataFim}|}">
                            Pr√≥xima
                        </a>
                    </span>
                </div>
            </section>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
