<!-- File: templates/usuarios/list.html -->
<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <th:block th:replace="~{fragments/head :: head('MotoTrack â€¢ UsuÃ¡rios')}"></th:block>
    <th:block th:replace="~{fragments/css :: mototrack}"></th:block>
    <title>MotoTrack</title>
</head>

<body>
<div class="wrap">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="mt-20" aria-label="Lista de UsuÃ¡rios">
        <div class="page-wrap">
            <div th:replace="~{fragments/flash :: banners}"></div>

            <section class="card">
                <h2>ðŸ‘¤ UsuÃ¡rios</h2>

                <!-- Filtro -->
                <form class="filter" th:action="@{/usuarios/ui}" method="get" aria-label="Filtro de usuÃ¡rios">
                    <div>
                        <label for="f-nome">Nome</label>
                        <input id="f-nome" type="text" name="nome"
                               th:value="${filtro != null ? filtro.nome : ''}"
                               placeholder="Nome" />
                    </div>
                    <div>
                        <label for="f-email">Email</label>
                        <input id="f-email" type="text" name="email"
                               th:value="${filtro != null ? filtro.email : ''}"
                               placeholder="Email" />
                    </div>
                    <div class="row">
                        <button class="btn ghost" type="submit">Filtrar</button>
                        <a class="btn ghost" th:href="@{/usuarios/ui}">Limpar</a>
                    </div>
                </form>

                <!-- AÃ§Ãµes ADMIN -->
                <div class="row my-12" sec:authorize="hasRole('ADMIN')">
                    <a class="btn primary" th:href="@{/usuarios/ui/novo}">âž• Novo usuÃ¡rio</a>
                </div>

                <!-- Tabela -->
                <div class="table-wrap" role="region" aria-label="Tabela de usuÃ¡rios">
                    <table>
                        <thead>
                        <tr>
                            <th class="col-id">ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th style="width:120px">Perfil</th>
                            <th class="col-actions">AÃ§Ãµes</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="row : ${page.content}">
                            <td th:text="${row.id}"></td>
                            <td th:text="${row.nome}"></td>
                            <td th:text="${row.email}"></td>
                            <td th:text="${row.perfil}"></td>
                            <td class="actions-cell">
                                <a class="btn warn" th:href="@{|/usuarios/ui/${row.id}/editar|}"
                                   sec:authorize="hasRole('ADMIN')">Editar</a>

                                <form class="inline" th:action="@{|/usuarios/ui/${row.id}/excluir|}"
                                      method="post" sec:authorize="hasRole('ADMIN')">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button class="btn danger" type="submit"
                                            onclick="return confirm('Confirmar exclusÃ£o?')">Excluir</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${page.content.size() == 0}">
                            <td colspan="5" class="text-center">
                                <span class="text-muted">Nenhum registro encontrado.</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- PaginaÃ§Ã£o -->
                <div class="pager" aria-label="PaginaÃ§Ã£o">
                    <span>
                        PÃ¡gina <strong th:text="${page.number + 1}"></strong>
                        de <strong th:text="${page.totalPages}"></strong>
                    </span>

                    <span th:if="${page.hasPrevious()}">
                        <a th:href="@{|/usuarios/ui?page=${page.number - 1}&size=${page.size}
                                      &nome=${filtro != null ? filtro.nome : ''}&email=${filtro != null ? filtro.email : ''}|}">
                            Anterior
                        </a>
                    </span>

                    <span th:if="${page.hasNext()}">
                        <a th:href="@{|/usuarios/ui?page=${page.number + 1}&size=${page.size}
                                      &nome=${filtro != null ? filtro.nome : ''}&email=${filtro != null ? filtro.email : ''}|}">
                            PrÃ³xima
                        </a>
                    </span>
                </div>
            </section>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
