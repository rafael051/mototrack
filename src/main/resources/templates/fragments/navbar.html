<!-- templates/fragments/navbar.html -->
<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<!-- ============== NAVBAR ============== -->
<header class="navbar" th:fragment="navbar" aria-label="Cabeçalho do sistema">
    <div class="nv-accent" aria-hidden="true"></div>

    <div class="nv-bar">
        <div class="nv-row">

            <!-- Marca -->
            <div class="nv-brand">
                <div class="nv-logo" aria-hidden="true" title="Mottu">
                    <svg viewBox="0 0 24 24" role="img" aria-label="Mottu">
                        <path d="M4 19V7c0-1.1.9-2 2-2h2.2l3.2 5 3.2-5H17c1.1 0 2 .9 2 2v12h-3V10.8l-2.6 4.1h-2.8L7 10.8V19H4z" fill="#0d291b"/>
                    </svg>
                </div>

                <div>
                    <h1 class="nv-title">MotoTrack</h1>

                    <!-- Autenticado -->
                    <div class="nv-sub" sec:authorize="isAuthenticated()">
                        Olá, <strong sec:authentication="name">usuário</strong>
                        <span class="nv-sep">•</span>
                        <span th:with="auths=${#authentication.authorities}" th:if="${auths}!=null">
                <span th:each="a : ${auths}" th:text="${a}">ROLE_USER</span>
              </span>
                    </div>

                    <!-- Anônimo -->
                    <div class="nv-sub" sec:authorize="!isAuthenticated()">Você não está autenticado.</div>
                </div>
            </div>

            <!-- Sessão -->
            <nav class="nv-session" aria-label="Sessão">
                <a class="btn" th:href="@{/home/ui}">Início</a>
                <a class="btn" th:href="@{/login}" sec:authorize="!isAuthenticated()">Entrar</a>
                <form class="form-inline" th:action="@{/logout}" method="post" sec:authorize="isAuthenticated()">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button class="btn primary" type="submit">Sair</button>
                </form>
            </nav>


        </div>
    </div>
</header>
<!-- ============ /NAVBAR ============ -->


<!-- ========== BOTÃO VOLTAR AO TOPO (opcional) ========== -->
<div th:fragment="backToTop">
    <button class="btn-to-top" type="button" aria-label="Voltar ao topo" title="Voltar ao topo">↑</button>

    <script>
        (function () {
            const btn = document.currentScript.previousElementSibling;
            const showAfter = 200; // px

            function onScroll() {
                if (window.scrollY > showAfter) {
                    btn.classList.add('show');
                } else {
                    btn.classList.remove('show');
                }
            }

            function toTop() {
                const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                window.scrollTo({ top: 0, behavior: prefersReduced ? 'auto' : 'smooth' });
            }

            btn.addEventListener('click', toTop, { passive: true });
            window.addEventListener('scroll', onScroll, { passive: true });
            onScroll();
        })();
    </script>
</div>
<!-- ======== /BOTÃO VOLTAR AO TOPO ======== -->

</body>
</html>
