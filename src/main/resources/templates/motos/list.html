<!-- File: templates/motos/list.html -->
<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <th:block th:replace="~{fragments/head :: head('MotoTrack â€¢ Motos')}"></th:block>
    <th:block th:replace="~{fragments/css :: mototrack}"></th:block>
    <title>MotoTrack</title>
</head>

<body>
<div class="wrap">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="mt-20" aria-label="Lista de Motos">
        <div class="page-wrap">
            <div th:replace="~{fragments/flash :: banners}"></div>

            <section class="card">
                <h2>ðŸ›µ Motos</h2>

                <!-- Filtro -->
                <form class="filter" th:action="@{/motos/ui}" method="get" aria-label="Filtro de motos">
                    <div>
                        <label for="f-placa">Placa</label>
                        <input id="f-placa" type="text" name="placa" th:value="${filtro.placa}" placeholder="AAA0A00"/>
                    </div>
                    <div>
                        <label for="f-modelo">Modelo</label>
                        <input id="f-modelo" type="text" name="modelo" th:value="${filtro.modelo}" placeholder="Modelo"/>
                    </div>
                    <div>
                        <label for="f-marca">Marca</label>
                        <input id="f-marca" type="text" name="marca" th:value="${filtro.marca}" placeholder="Marca"/>
                    </div>
                    <div>
                        <label for="f-ano">Ano</label>
                        <input id="f-ano" type="number" name="ano" th:value="${filtro.ano}" placeholder="2022"/>
                    </div>
                    <div>
                        <label for="f-status">Status</label>
                        <input id="f-status" type="text" name="status" th:value="${filtro.status}" placeholder="DisponÃ­vel, Locada..."/>
                    </div>
                    <div>
                        <label for="f-filial">Filial</label>
                        <input id="f-filial" type="text" name="filial" th:value="${filtro.filial}" placeholder="Nome/CÃ³digo da filial"/>
                    </div>
                    <div class="row">
                        <button class="btn ghost" type="submit">Filtrar</button>
                        <a class="btn ghost" th:href="@{/motos/ui}">Limpar</a>
                    </div>
                </form>

                <!-- AÃ§Ãµes ADMIN -->
                <div class="row my-12" sec:authorize="hasRole('ADMIN')">
                    <a class="btn primary" th:href="@{/motos/ui/novo}">âž• Nova moto</a>
                </div>

                <!-- Tabela -->
                <div class="table-wrap" role="region" aria-label="Tabela de motos">
                    <table>
                        <thead>
                        <tr>
                            <th class="col-id">ID</th>
                            <th>Placa</th>
                            <th>Modelo</th>
                            <th>Marca</th>
                            <th>Ano</th>
                            <th>Status</th>
                            <th>Filial</th>
                            <th>Latitude</th>
                            <th>Longitude</th>
                            <th class="col-actions">AÃ§Ãµes</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="row : ${page.content}">
                            <td th:text="${row.id}"></td>
                            <td th:text="${row.placa}"></td>
                            <td th:text="${row.modelo}"></td>
                            <td th:text="${row.marca}"></td>
                            <td th:text="${row.ano}"></td>
                            <td th:text="${row.status}"></td>
                            <td th:text="${row.filialNome != null ? row.filialNome : row.filialId}"></td>
                            <td th:text="${row.latitude}"></td>
                            <td th:text="${row.longitude}"></td>
                            <td class="actions-cell">
                                <a class="btn warn" th:href="@{|/motos/ui/${row.id}/editar|}"
                                   sec:authorize="hasRole('ADMIN')">Editar</a>
                                <form class="inline" th:action="@{|/motos/ui/${row.id}/excluir|}"
                                      method="post" sec:authorize="hasRole('ADMIN')">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button class="btn danger" type="submit"
                                            onclick="return confirm('Confirmar exclusÃ£o?')">Excluir</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${page.content.size() == 0}">
                            <td colspan="10" class="text-center">
                                <span class="text-muted">Nenhum registro encontrado.</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- PaginaÃ§Ã£o (preservando filtros) -->
                <div class="pager" aria-label="PaginaÃ§Ã£o">
                    <span>
                        PÃ¡gina <strong th:text="${page.number + 1}"></strong>
                        de <strong th:text="${page.totalPages}"></strong>
                    </span>

                    <span th:if="${page.hasPrevious()}">
                        <a th:href="@{|/motos/ui?page=${page.number - 1}&size=${page.size}
                                      &placa=${filtro.placa}&modelo=${filtro.modelo}&marca=${filtro.marca}
                                      &ano=${filtro.ano}&status=${filtro.status}&filial=${filtro.filial}|}">
                            Anterior
                        </a>
                    </span>

                    <span th:if="${page.hasNext()}">
                        <a th:href="@{|/motos/ui?page=${page.number + 1}&size=${page.size}
                                      &placa=${filtro.placa}&modelo=${filtro.modelo}&marca=${filtro.marca}
                                      &ano=${filtro.ano}&status=${filtro.status}&filial=${filtro.filial}|}">
                            PrÃ³xima
                        </a>
                    </span>
                </div>
            </section>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
