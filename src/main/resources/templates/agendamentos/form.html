<!-- File: templates/agendamentos/form.html -->
<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <!-- head global (já inclui mototrack.css) -->
    <th:block th:replace="~{fragments/head :: head(${id != null} ? 'MotoTrack • Editar Agendamento' : 'MotoTrack • Novo Agendamento')}"></th:block>
    <!-- opcional: incluir css explícito -->
    <th:block th:replace="~{fragments/css :: mototrack}"></th:block>
</head>

<body>
<div class="wrap">
    <!-- Navbar -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="mt-20" aria-label="Formulário de Agendamento">
        <!-- Sucesso -->
        <div class="flash ok" th:if="${msgSucesso}" th:text="${msgSucesso}"></div>

        <!-- Form principal -->
        <section class="card" aria-labelledby="form-title">
            <h2 id="form-title" th:text="${id != null ? '✏️ Editar Agendamento' : '📅 Novo Agendamento'}">📅 Novo Agendamento</h2>
            <p class="muted" th:if="${id == null}">Preencha os dados abaixo para criar um novo agendamento.</p>
            <p class="muted" th:if="${id != null}">Atualize apenas os campos necessários.</p>

            <form th:action="${id != null} ? @{|/agendamentos/ui/${id}|} : @{/agendamentos/ui}"
                  method="post" th:object="${agendamento}">
                <!-- Erros globais -->
                <div class="flash err" th:if="${#fields.hasErrors('*')}">
                    <strong>Erros de validação:</strong>
                    <ul style="margin:8px 0 0 18px">
                        <li th:each="e : ${#fields.errors('*')}" th:text="${e}"></li>
                    </ul>
                </div>

                <!-- Grid dos campos (reaproveita o layout do .filter) -->
                <div class="filter">
                    <!-- Data/Hora -->
                    <div>
                        <label for="dataAgendada">Data/Hora</label>
                        <input id="dataAgendada" type="datetime-local" th:field="*{dataAgendada}" required/>
                        <small class="muted">Formato: dd/mm/aaaa hh:mm</small>
                    </div>

                    <!-- Moto ID -->
                    <div>
                        <label for="motoId">Moto (ID)</label>
                        <input id="motoId" type="number" th:field="*{motoId}" min="1" placeholder="ID da moto" required/>
                    </div>

                    <!-- Descrição (linha inteira) -->
                    <div class="grid-span-all">
                        <label for="descricao">Descrição</label>
                        <textarea id="descricao" rows="3" th:field="*{descricao}" placeholder="Ex.: Troca de óleo e revisão geral" required></textarea>
                    </div>
                </div>

                <!-- CSRF -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- Ações -->
                <div class="actions">
                    <button type="submit" class="btn primary"
                            th:text="${id != null ? 'Atualizar agendamento' : 'Salvar agendamento'}">Salvar</button>
                    <a class="btn ghost" th:href="@{/agendamentos/ui}">Voltar</a>
                </div>
            </form>
        </section>

        <!-- Excluir (somente ADMIN e quando há id) -->
        <section class="card mt-14" th:if="${id != null}" sec:authorize="hasRole('ADMIN')" aria-label="Ações avançadas">
            <h2>Ações</h2>
            <form th:action="@{'/agendamentos/ui/' + ${id}}" method="post" style="display:inline">
                <input type="hidden" name="_method" value="delete"/>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button class="btn danger" type="submit" onclick="return confirm('Confirmar exclusão?')">Excluir</button>
            </form>
        </section>
    </main>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
