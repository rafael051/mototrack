<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <th:block th:replace="~{fragments/head :: head('MotoTrack â€¢ Agendamentos')}"></th:block>
    <th:block th:replace="~{fragments/css :: mototrack}"></th:block>
    <title>MotoTrack</title>
</head>

<body>
<div class="wrap">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <!-- antes: style="margin-top:20px" -->
    <main class="mt-20" aria-label="Lista de Agendamentos">
        <div class="page-wrap">
            <div th:replace="~{fragments/flash :: banners}"></div>

            <section class="card">
                <h2>ðŸ“… Agendamentos</h2>

                <!-- Filtro -->
                <form class="filter" th:action="@{/agendamentos/ui}" method="get" aria-label="Filtro de agendamentos">
                    <div>
                        <label for="f-id">ID</label>
                        <input id="f-id" type="number" name="id" th:value="${filtro.id}" min="1" />
                    </div>
                    <div>
                        <label for="f-motoId">Moto ID</label>
                        <input id="f-motoId" type="number" name="motoId" th:value="${filtro.motoId}" min="1" />
                    </div>
                    <div>
                        <label for="f-descricao">DescriÃ§Ã£o</label>
                        <input id="f-descricao" type="text" name="descricao" th:value="${filtro.descricao}" placeholder="Texto da descriÃ§Ã£o" />
                    </div>
                    <div>
                        <label for="f-dataInicio">Data inicial</label>
                        <input id="f-dataInicio" type="text" name="dataInicio"
                               placeholder="dd/mm/aaaa"
                               inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}" maxlength="10"
                               oninput="this.value=this.value.replace(/\D/g,'').slice(0,8).replace(/(\d{2})(\d)/,'$1/$2').replace(/(\d{2})(\d)/,'$1/$2');"
                               th:value="${filtro.dataInicio != null ? #temporals.format(filtro.dataInicio, 'dd/MM/yyyy') : ''}" />
                    </div>

                    <div>
                        <label for="f-dataFim">Data final</label>
                        <input id="f-dataFim" type="text" name="dataFim"
                               placeholder="dd/mm/aaaa"
                               inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}" maxlength="10"
                               oninput="this.value=this.value.replace(/\D/g,'').slice(0,8).replace(/(\d{2})(\d)/,'$1/$2').replace(/(\d{2})(\d)/,'$1/$2');"
                               th:value="${filtro.dataFim != null ? #temporals.format(filtro.dataFim, 'dd/MM/yyyy') : ''}" />
                    </div>

                    <div class="row">
                        <button class="btn ghost" type="submit">Filtrar</button>
                        <a class="btn ghost" th:href="@{/agendamentos/ui}">Limpar</a>
                    </div>
                </form>

                <!-- AÃ§Ãµes ADMIN â€“ antes: style="margin:12px 0" -->
                <div class="row my-12" sec:authorize="hasRole('ADMIN')">
                    <a class="btn primary" th:href="@{/agendamentos/ui/novo}">âž• Novo agendamento</a>
                </div>

                <!-- Tabela -->
                <div class="table-wrap" role="region" aria-label="Tabela de agendamentos">
                    <table>
                        <thead>
                        <tr>
                            <!-- antes: style="width:90px" -->
                            <th class="col-id">ID</th>
                            <th>Data/Hora</th>
                            <th>Moto ID</th>
                            <th>DescriÃ§Ã£o</th>
                            <!-- antes: style="width:220px" -->
                            <th class="col-actions">AÃ§Ãµes</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="row : ${page.content}">
                            <td th:text="${row.id}"></td>
                            <td th:text="${#temporals.format(row.dataAgendada, 'dd/MM/yyyy HH:mm')}"></td>
                            <td th:text="${row.motoId}"></td>
                            <td th:text="${row.descricao}"></td>
                            <td class="actions-cell">
                                <a class="btn warn" th:href="@{|/agendamentos/ui/${row.id}/editar|}">Editar</a>
                                <!-- antes: style="display:inline" -->
                                <form class="inline" th:action="@{|/agendamentos/ui/${row.id}/excluir|}" method="post">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button class="btn danger" type="submit" onclick="return confirm('Confirmar exclusÃ£o?')">Excluir</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${page.content.size() == 0}">
                            <td colspan="5" class="text-center">
                                <span class="text-muted">Nenhum registro encontrado.</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- PaginaÃ§Ã£o -->
                <div class="pager" aria-label="PaginaÃ§Ã£o">
                    <span>PÃ¡gina <strong th:text="${page.number + 1}"></strong> de <strong th:text="${page.totalPages}"></strong></span>

                    <span th:if="${page.hasPrevious()}">
            <a th:href="@{|/agendamentos/ui?page=${page.number - 1}&size=${page.size}
                            &id=${filtro.id}&motoId=${filtro.motoId}
                            &descricao=${filtro.descricao}
                            &dataInicio=${filtro.dataInicio}&dataFim=${filtro.dataFim}|}">Anterior</a>
          </span>

                    <span th:if="${page.hasNext()}">
            <a th:href="@{|/agendamentos/ui?page=${page.number + 1}&size=${page.size}
                            &id=${filtro.id}&motoId=${filtro.motoId}
                            &descricao=${filtro.descricao}
                            &dataInicio=${filtro.dataInicio}&dataFim=${filtro.dataFim}|}">PrÃ³xima</a>
          </span>
                </div>
            </section>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
